# ─────────────────────────────────────────────────────────
# MoodBoard — Render Blueprint
# Single Web Service: Backend (API + WebSocket) + Frontend (static)
# Database: External MySQL on All-Inkl (not managed by Render)
# ─────────────────────────────────────────────────────────
services:
  - type: web
    name: moodboard
    runtime: node
    region: frankfurt
    plan: free
    buildCommand: "cd frontend && npm install --include=dev && npm run build && cd ../backend && npm install"
    startCommand: "cd backend && node server.js"
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: "10000"
      # ── Database (All-Inkl MySQL) ──
      - key: DB_HOST
        sync: false   # Set manually: w01f8a36.kasserver.com
      - key: DB_PORT
        value: "3306"
      - key: DB_USER
        sync: false   # Set manually: d0463367
      - key: DB_PASSWORD
        sync: false   # Set manually
      - key: DB_NAME
        sync: false   # Set manually: d0463367
      - key: DB_DIALECT
        value: mysql
      # ── Auth ──
      - key: SESSION_SECRET
        generateValue: true
      - key: JWT_SECRET
        generateValue: true
      # ── LTI 1.3 (set after Moodle registration) ──
      - key: LTI_PLATFORM_ISS
        sync: false
      - key: LTI_CLIENT_ID
        sync: false
      - key: LTI_AUTH_ENDPOINT
        sync: false
      - key: LTI_TOKEN_ENDPOINT
        sync: false
      - key: LTI_JWKS_ENDPOINT
        sync: false
      - key: TOOL_PRIVATE_KEY
        sync: false
      - key: TOOL_PUBLIC_KEY
        sync: false
      - key: TOOL_KEY_ID
        value: tool-key-1
      # ── URLs (auto-set after first deploy) ──
      - key: FRONTEND_URL
        sync: false   # Set to: https://moodboard.onrender.com
      - key: ALLOWED_ORIGINS
        sync: false   # Set to: https://moodboard.onrender.com
